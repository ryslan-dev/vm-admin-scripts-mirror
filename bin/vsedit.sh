#!/bin/bash

if [ -z "$1" ]; then
    echo "‚ùå –í–∫–∞–∂–∏ —à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É: vsed /etc/...."
    exit 1
fi

TMP_FILE=/tmp/.vsed_tmp_$$
FILE="$1"

echo "üîÑ –ö–æ–ø—ñ—é—é $FILE —É —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª..."
if sudo cp "$FILE" "$TMP_FILE" && sudo chown "$USER":"$USER" "$TMP_FILE"; then
    echo "üìù –í—ñ–¥–∫—Ä–∏–≤–∞—é —Ñ–∞–π–ª —É VS Code..."
    code --wait "$TMP_FILE"
    echo "‚¨ÜÔ∏è –ó–±–µ—Ä—ñ–≥–∞—é –∑–º—ñ–Ω–∏ –Ω–∞–∑–∞–¥ —É $FILE..."
    if sudo cp "$TMP_FILE" "$FILE"; then
        echo "‚úÖ –§–∞–π–ª –æ–Ω–æ–≤–ª–µ–Ω–æ: $FILE"
    else
        echo "‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –Ω–∞–∑–∞–¥. –ü–µ—Ä–µ–≤—ñ—Ä –ø—Ä–∞–≤–∞."
    fi
    rm -f "$TMP_FILE"
else
    echo "‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∏–º—á–∞—Å–æ–≤—É –∫–æ–ø—ñ—é. –ú–æ–∂–ª–∏–≤–æ, –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É."
fi
