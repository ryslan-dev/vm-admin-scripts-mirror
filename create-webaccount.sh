#!/bin/bash

# === –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ ===
if [[ -z "$1" || -z "$2" ]]; then
  echo "‚ùå –ü–æ–º–∏–ª–∫–∞: –≤–∫–∞–∂–∏ —ñ–º‚Äô—è –∞–∫–∞—É–Ω—Ç–∞ —ñ –ø–∞—Ä–æ–ª—å —è–∫ –∞—Ä–≥—É–º–µ–Ω—Ç–∏."
  exit 1
fi

user="$1"
user_pass="$2"
base_dir="/var/www/$user"
data_dir="$base_dir/data"
www_dir="$data_dir/www"
shell="/bin/bash"

# === –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î ===
if id "$user" &>/dev/null; then
  echo "üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á $user –≤–∂–µ —ñ—Å–Ω—É—î."
else
  echo "‚ûï –°—Ç–≤–æ—Ä—é—î–º–æ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ $user..."
  sudo useradd -m -d "$data_dir" -s "$shell" "$user"
  echo "$user:$user_pass" | sudo chpasswd
  echo "‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ $user —Å—Ç–≤–æ—Ä–µ–Ω–æ."

  # === –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–∞–∑–æ–≤–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ ===
  echo "üìÅ –°—Ç–≤–æ—Ä—é—î–º–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π –∞–∫–∞—É–Ω—Ç–∞..."
  sudo mkdir -p "$www_dir"
  for dir in logs mail php-bin backup; do
    sudo mkdir -p "$data_dir/$dir"
  done
  sudo chown -R "$user:$user" "$base_dir"
fi

# === –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∞–∫–∞—É–Ω—Ç–∞ ===
echo "üöÄ –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–ª—è –∞–∫–∞—É–Ω—Ç–∞..."
sudo set-webuser-perms "$user"

# === –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ FTP-–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ===
echo "üîß –°—Ç–≤–æ—Ä—é—î–º–æ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ FTP-–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ $user..."
sudo add-ftpuser "$user" passwd="$user_pass" user="$user"

echo "‚úÖ –ê–∫–∞—É–Ω—Ç $user —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞ FTP-–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ–¥–∞–Ω–æ."
